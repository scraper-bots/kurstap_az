// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String   // Hashed password
  firstName String?
  lastName  String?
  imageUrl  String?
  
  // Email verification
  emailVerified DateTime?
  emailVerificationToken String?
  
  // Password reset
  resetPasswordToken String?
  resetPasswordTokenExpires DateTime?
  
  // User preferences and settings
  interviewCredits Int @default(0) // Number of interviews user can take
  role UserRole @default(USER)
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  interviews    Interview[]
  payments      Payment[]
  userSessions  UserSession[]
  
  @@map("users")
}

model UserSession {
  id        String   @id @default(cuid())
  sessionId String   @unique
  userId    String
  expiresAt DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("user_sessions")
}

model Interview {
  id          String        @id @default(cuid())
  userId      String
  title       String
  description String?
  position    String        // Job position being interviewed for
  company     String?       // Company name
  difficulty  Difficulty    @default(MEDIUM)
  mode        InterviewMode @default(STANDARD) // New: Interview mode with predefined settings
  status      InterviewStatus @default(SCHEDULED)
  
  // Interview content - now all questions provided at once
  questions   Json[]        // Array of detailed question objects with metadata
  totalQuestions Int         // Total number of questions for this interview
  duration    Int?          // Total duration in minutes
  feedback    String?       // AI feedback
  score       Float?        // Overall score (0-100)
  
  // Video recording and analysis
  videoUrl         String?   // URL to recorded video
  videoAnalysis    Json?     // AI analysis of video (facial expressions, body language, etc.)
  audioTranscript  String?   // Full transcript of the video
  
  // Detailed analysis data
  categoryScores    Json?     // Scores by category (Behavioral, Technical, etc.)
  overallAnalysis   Json?     // Strengths, weaknesses, recommendations
  responseMetrics   Json?     // Response time, confidence levels, facial analysis
  benchmarkData     Json?     // Industry comparison data
  improvementPlan   Json?     // Roadmap and resources
  
  // Scheduling
  scheduledAt DateTime?
  completedAt DateTime?
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  user      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("interviews")
}

// InterviewAnswer data moved to Interview.questions JSON field

// Session functionality merged into Interview model

// Subscription model removed - moved to credit-only system

model Payment {
  id        String        @id @default(cuid())
  userId    String
  
  // Order details
  orderId     String       @unique  // Unique order ID for Epoint
  amount      Float                 // Payment amount
  currency    String       @default("AZN")
  description String?
  
  // Payment status
  status      PaymentStatus @default(PENDING)
  
  // Epoint transaction data
  transactionId      String?  // Epoint transaction ID
  bankTransactionId  String?  // Bank transaction ID
  bankResponse       String?  // Bank response details
  responseCode       String?  // Response code from bank
  responseMessage    String?  // Response message
  rrn               String?  // Retrieval Reference Number
  cardName          String?  // Cardholder name
  cardMask          String?  // Masked card number
  
  // URLs for redirect
  successUrl String
  errorUrl   String
  
  // Error details
  errorMessage String?
  
  // Payment form data (for gateways that return HTML forms)
  formHtml String? // HTML form content for payment submission
  
  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  // Relations
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  @@map("payments")
}

// Enums

enum Difficulty {
  EASY
  MEDIUM
  HARD
}

enum InterviewStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

// Session enums removed

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

enum InterviewMode {
  QUICK_ASSESSMENT    // 3 questions, 5 minutes total
  STANDARD           // 5 questions, 15 minutes total
  COMPREHENSIVE      // 8 questions, 25 minutes total
  TECHNICAL_DEEP     // 10 questions, 35 minutes total, high difficulty
  BEHAVIORAL_FOCUS   // 6 questions, 20 minutes, behavioral only
  MIXED_CHALLENGE    // 12 questions, 45 minutes, all difficulties
}

enum UserRole {
  USER
  ADMIN
}
